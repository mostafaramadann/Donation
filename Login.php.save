<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="Login.css">
	<title>Donation Portal-Login</title>
</head>
<body>

<!--	<h1>Donation Portal</h1>-->
<?php
    include("Header.php");
?>
	<div class="form">
		<h2>Login</h2>
		<form method="post">
			<div style="display:inline;">
				Username:<input type="text" name="UserName" />
			</div>
			<div style="display:inline;">
				Password:<input type="password" name="Password" />
			</div>
			<button type="submit" name="login"> Login </button>
			<p class="message">Not Registered ? <a href="Register.php">Create Account</a></p>
		</form>
	</div>
    <script>

    </script>
	<?php
    if(isset($_POST['login']))
    {
        verify();
    }
    function verify()
    {
        session_start();
        var_dump(file_exists("Loader.php"));
        if(isset($_SESSION["loggedin"]) && $_SESSION["loggedin"] === true){
            header("location: Home.php");
            exit;
        }
       else  {
            require_once("Loader.php");
            if ($_POST['Password'] != '' || $_POST['UserName'] != '') {
                $u = Loader::GetInstance()::LoadUserProfileFromDatabase($_POST['UserName'], $_POST['Password']);
                if ($u != null) {
                    echo "Sign in successful";
                    require_once("usercookies.php");
                    require_once("Home.php");
                    echo $u->GetID();
                    echo $u->GetFirstName();
                    echo $u->getLastName();
                    echo $u->getUsername();
                    echo $u->getPassword();
                    echo $u->getBankAccountNo();
                    echo $u->getEmail();
                    echo $u->getPhone();
//                us4ercookies::getInstance()::setUser($u);
                 session_start();
                    $_SESSION["loggedin"] = true;
                    $_SESSION["id"] = $u->getID();
                    $_SESSION["username"] = $u->getUsername();
		    
                 //   session_commit();
			if ($_SESSION["userType"] = 0)
			{
				header("location: Home.php");
			}
			else if ($_SESSION["userType"] = 1)
			{
				header("location; adminHome.php");
			}
                    exit;
                } else {
                    echo "Sign in failed";
                }
            } else {
                echo "Empty strings";
            }
        }
    }
	?>
<!--	<footer>-->
<!--	</footer>-->
</body>
</html>
